!function(){window._prof_hash={};var e,n,r="INTERNSHIP_REQUEST",l=!1,u=!1,d=!1,p=[];function c(){return createUUID1()}currentUserFull&&(_.each(currentUserFull.roles,function(e){-1<e.indexOf("Учебное заведение")&&(l=!0),-1<e.indexOf("Кандидат")&&(d=!0),-1<e.indexOf("Работодатель")&&(u=!0)}),n=JSON.parse(currentUserFull.externalData||"{}"),e={},_.has(n,"inn")&&!_.isNull(n.inn)&&(e.inn=[n.inn]),_.has(n,"kpp")&&!_.isNull(n.kpp)&&(e.kpp=[n.kpp]),_.has(n,"ogrn")&&!_.isNull(n.ogrn)&&(e.ogrn=[n.ogrn]),_.keys(e).length)&&(n=getCatalogData(l?"INSTITUTION":u?"EMPLOYER":d?"STUDENT":"",e),console.log(n),n.done(function(e){p=e.result.data[0]||[]})),window.initAllDialogProfDialog=function(){var i=$("#internship_request"),a=null,o=null;i.on("show.bs.modal",function(e){o=$(e.relatedTarget)}),$("input[type=file]",i).on("change",function(){a=$(this).get(0).files,$(".upload__file",i).text(a[0].name)}),i.off("submit").on("submit",function(e){e.preventDefault();var n,t=function(e){e={request_description:$("textarea",e).val(),prof_activity_code:window.__activity_area_uid,region_code:$(".js_region",e).val().toString(),application_creation_date:moment().valueOf(),publication_status:!1,prof_activity_name:window.__activity_area_name};l&&(e.id_institution=p[0]);u&&(e.id_employer=p[0]);d&&(e.id_student=p[0]);return e}(i);return(l||u)&&(t.code=o.data("profuid")||null,t.prof_name=o.data("profession")||"",e=a,(n=new FormData).append("docDate",moment().format("YYYY-MM-DDT00:00:00")),n.append("docNumber",c()),n.append("docTypeCode","studDoc"),n.append("extId",c()),n.append("file",e[0]),n.append("name","Договор оферта"),n.append("nomenclature","string"),n.append("srcSystem","intern"),$.ajax({url:"/api/archive/store",data:n,contentType:!1,processData:!1,type:"POST"}).done(function(e){t.file=e.extId,function(e){e=[c(),e.request_description,e.region_code,"",e.file,e.prof_activity_code,e.code,e.id_institution||null,e.id_employer||null,e.id_student||null,"","Партнерское соглашение",null,null,"",null,null,e.application_creation_date,"","",e.region_code,e.prof_activity_name,e.prof_name,"","",!0],e={url:"//test-portal.trudvsem.ru/information/catalogprovider/api/1.2/catalog/create?code="+r+"&unique_request_identifier="+_.uniqueId("INTERNSHIP_REQUEST_")+"&data="+encodeURIComponent(JSON.stringify(e))+"&version=1.2",dataType:"json",contentType:"application/json",method:"POST"};return $.ajax(e)}(t).done(function(){i.modal("hide")})})),!1})}}();