!function(){var t,e="NOTIFICATIONS",n="Работодатель",o=["Кандидат",n,"Учебное заведение"],r=function(t){for(var e=Object.keys(t).map((function(e){return t[e]})),n=0;n<e.length;n++)if(-1!==o.indexOf(e[n]))return e[n];return"USER_ROLE_UNKNOWN"}(currentUserFull.roles);currentUserFull.id;var a=function(e){var n=$(this),o=$(e.relatedTarget);
//! set cooperation id globally
t=o.data("cooperation-id"),n.find("[data-content=cooperation-type]").text(o.data("cooperation-type")),n.find("[data-content=cooperation-partner]").text(o.data("cooperation-partner")),n.find("[data-action=contract-delete]").off("click",i).on("click",i)};function i(){var o,a,i,d;getCatalogItem("COOPERATION",t).then((function(t){return o=t[1],a=t[4],i=t[5],d=t[6],deferrers=[a?getCatalogItem("STUDENT",a):null,getCatalogItem("INSTITUTION",i),getCatalogItem("EMPLOYER",d)],$.when.apply($,deferrers)})).then((function(u,l,s){var p=u?u[1]:null,f=l[2],m=s[1],g="Договор "+o+" c "+(r===n?f:m)+(p?" и студентом ".concat(p):"")+" удален";console.log(g);var h,O={cooperation:t,user:currentUserFull.id,student:a,institution:i,employer:d};return console.log("ids",O),$.when(function(t){return function(t){var n={id_cooperation:t,reading_marker:!1};return getCatalogData(e,n).then((function(t){return t.result.data}))}(t).then((function(t){var e=t.map((function(t){return t[0]}));return console.log("notifications:",t),e})).then((function(t){var n;return t.length>0?(n=t.map((function(t){!function(t,n){(function(t,e,n){var o="//test-portal.trudvsem.ru/information/catalogprovider/api/1.2/catalog/updateFields?code="+e.toUpperCase()+"&id="+t+"&unique_request_identifier="+_.uniqueId("PC_")+"&version=1.2",r={url:o,dataType:"json",contentType:"application/json",method:"POST",data:JSON.stringify(n)};return $.ajax(r)})(t,e,n).catch(c)}(t,{reading_marker:!0})})),$.when.apply($,n)):$.Deferred((function(){this.resolve()}))})).catch(c)}(t),(h={url:"//test-portal.trudvsem.ru/information/catalogprovider/api/1.2/catalog/updateFields?code=COOPERATION&id="+t+"&unique_request_identifier="+_.uniqueId("COOPERATION_")+"&version=1.2",dataType:"json",contentType:"application/json",method:"POST",data:JSON.stringify({deleted:!0})},void $.ajax(h)),function(t,e){var n=[t.student,t.employer,t.institution].filter((function(e){return e&&e!==t.user})),o={id_cooperation:t.cooperation,date:Date.now(),reading_marker:!1,text:e||"",id_student:t.student,id_institution:t.institution,id_employer:t.employer},r=n.map((function(t){return sendNotification(t,o)}));return $.when.apply($,r)}(O,g))})).then(u).catch(c)}function u(){document.location.reload(!0)}function c(t){console.error(t)}$("body").off("show.bs.modal","#delete-modal",a).on("show.bs.modal","#delete-modal",a)}();